## iptables_rules

`iptables_rules` is generated by:

```sh
# redirect all tcp packets to server's port 10000-65000 to port 12345
iptables -t nat -I PREROUTING -i eth0 -p tcp --dport 10000:65000 -j REDIRECT --to-port 12345

# drop packets with RST flag set and other flags unset
iptables -I OUTPUT -p tcp --tcp-flags RST RST --sport 10000:65000 -j DROP
# drop packets with RST,ACK flags set and other flags unset
iptables -I OUTPUT -p tcp --tcp-flags RST,ACK RST,ACK --sport 10000:65000 -j DROP
# Note that, as an example, a packet with SYN,RST flags will not be
# dropped by rules above; however, it is acceptable because it is
# abnormal, if possible, for the sink server to send SYN,RST packets

# drop any response from sport 53; note that we do not drop incoming
# packets to port 53 so that we can still inform whether packets are
# still being sent to the port 53.
iptables -I OUTPUT -p udp --sport 53 -j DROP
iptables -I OUTPUT -p icmp --icmp-type destination-unreachable -j DROP
iptables -I OUTPUT -p icmp --icmp-type port-unreachable -j DROP
```

Then, `sudo iptables-save > iptables_rules`.

To use it, `sudo iptables-restore < iptables_rules`. As example is available in `to_server.sh`.

## iptables_only_trageted_sip.sh

When knowing the client IPs, we can apply more accurate rules. This will avoid issues like SSH  port 22 is taken over by a redirect rule, which causes login issue.
